<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to continuous VPC • tidyvpc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to continuous VPC">
<meta property="og:description" content="tidyvpc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-0E7W4HDPHF"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0E7W4HDPHF');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyvpc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tidyvpc_cont.html">Continuous VPC</a>
    </li>
    <li>
      <a href="../articles/tidyvpc_cat.html">Categorical VPC</a>
    </li>
    <li>
      <a href="../articles/tidyvpc_RsNLME.html">Using tidyvpc with RsNLME</a>
    </li>
    <li>
      <a href="../articles/tidyvpc_nlmixr2.html">Using tidyvpc with nlmixr2</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://certara.github.io/R-Certara/index.html" class="external-link">Certara.R</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/certara/tidyvpc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to continuous VPC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/certara/tidyvpc/blob/HEAD/vignettes/tidyvpc_cont.Rmd" class="external-link"><code>vignettes/tidyvpc_cont.Rmd</code></a></small>
      <div class="hidden name"><code>tidyvpc_cont.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>When deriving a Visual Predictive Check (VPC) you
must:</strong></p>
<ul>
<li><p>Have both observed and simulated datasets that include x and y
variables, typically TIME and DV</p></li>
<li><p>Compute prediction intervals on simulated versus observed
data</p></li>
</ul>
<p><strong>When deriving a VPC you may want to:</strong></p>
<ul>
<li><p>Stratify over variables in your model</p></li>
<li><p>Censor data below LLOQ</p></li>
<li><p>Perform prediction correction (pcVPC)</p></li>
</ul>
<p><strong>The tidyvpc package makes these steps fast and
easy:</strong></p>
<ul>
<li><p>By providing readable syntax using the <code>%&gt;%</code>
operator from magrittr.</p></li>
<li><p>By using efficient backend computation, taking advantage of
<code>data.table</code> parallelization.</p></li>
<li><p>By providing traditional binning methods and new <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6202468/" class="external-link">binless
methods</a></p></li>
<li><p>By using ggplot2 graphics engine to visualize the results of the
VPC.</p></li>
</ul>
<hr>
<p>This document introduces you to the <code>tidyvpc</code> set of
tools, and shows you how to apply them to <code>tidyvpcobj</code> to
derive VPC.</p>
<p>All of the <code>tidyvpc</code> functions require the
<code>tidyvpcobj</code> as the first argument, with the exception of the
first function <code><a href="../reference/observed.html">observed()</a></code> in the piping chain, which takes
a <code>data.frame</code> or <code>data.table</code> of the observed
dataset. Rather than forcing the user to either save intermediate
objects or nest functions, <code>tidyvpc</code> provides the
<code>%&gt;%</code> operator from magrittr. The result from one step is
then “piped” into the next step, with the final function in the piping
chain always <code><a href="../reference/vpcstats.html">vpcstats()</a></code>. You can use the pipe to rewrite
multiple operations that you can read left-to-right, top-to-bottom
(reading the pipe operator as “then”).</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>To explore the functionality of tidyvpc, we’ll use an altered version
of obs_data(<code>vpc::simple_data$obs</code>) and
sim_data(<code>vpc::simple_data$sim</code>) from the vpc package. These
datasets contain all necessary variables to explore the functionality of
tidyvpc including:</p>
<ul>
<li><p>DV (y variable)</p></li>
<li><p>TIME (x variable)</p></li>
<li><p>NTIME (nominal time for binning on x-variable)</p></li>
<li><p>GENDER (gender variable for stratification, “M”, “F”)</p></li>
<li><p>STUDY (study for stratification, “Study A”, “Study B”)</p></li>
<li><p>PRED (prediction variable for pcVPC)</p></li>
<li><p>MDV (Missing DV)</p></li>
</ul>
<div class="section level3">
<h3 id="data-structure">Data Structure<a class="anchor" aria-label="anchor" href="#data-structure"></a>
</h3>
<p><code>tidyvpc</code> requires specific structure of observed and
simulated data to successfully generate VPC.</p>
<p>See <code><a href="../reference/obs_data.html">tidyvpc::obs_data</a></code> and <code><a href="../reference/sim_data.html">tidyvpc::sim_data</a></code>
for example <a href="https://certara.github.io/tidyvpc/#data-preprocessing" class="external-link">data
structure</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu">tidyvpc</span><span class="fu">::</span><span class="va"><a href="../reference/obs_data.html">obs_data</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ID      TIME   DV AMT DOSE MDV NTIME GENDER   STUDY</span></span>
<span><span class="co">#&gt; 1:  1 0.0000000  0.0 150  150   1  0.00      M Study A</span></span>
<span><span class="co">#&gt; 2:  1 0.2157624 37.3   0  150   0  0.25      M Study A</span></span>
<span><span class="co">#&gt; 3:  1 0.4694366 62.2   0  150   0  0.50      M Study A</span></span>
<span><span class="co">#&gt; 4:  1 0.8271844 74.1   0  150   0  1.00      M Study A</span></span>
<span><span class="co">#&gt; 5:  1 1.7724895 75.1   0  150   0  1.50      M Study A</span></span>
<span><span class="co">#&gt; 6:  1 1.7142415 58.3   0  150   0  2.00      M Study A</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu">tidyvpc</span><span class="fu">::</span><span class="va"><a href="../reference/sim_data.html">sim_data</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ID REP      TIME     DV  IPRED   PRED AMT DOSE MDV NTIME</span></span>
<span><span class="co">#&gt; 1:  1   1 0.0000000  0.000  0.000  0.000 150  150   1  0.00</span></span>
<span><span class="co">#&gt; 2:  1   1 0.2157624 24.470 22.400 29.931   0  150   0  0.25</span></span>
<span><span class="co">#&gt; 3:  1   1 0.4694366 49.541 38.780 49.995   0  150   0  0.50</span></span>
<span><span class="co">#&gt; 4:  1   1 0.8271844 56.510 58.644 69.981   0  150   0  1.00</span></span>
<span><span class="co">#&gt; 5:  1   1 1.7724895 63.165 67.310 73.799   0  150   0  1.50</span></span>
<span><span class="co">#&gt; 6:  1   1 1.7142415 66.649 69.466 69.487   0  150   0  2.00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preprocessing-data">Preprocessing data<a class="anchor" aria-label="anchor" href="#preprocessing-data"></a>
</h3>
<p>First, we’ll need to subset our data by filtering
<code>MDV == 0</code>, which removes rows where both
<code>DV == 0</code> and <code>TIME == 0</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span><span class="va">MDV</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">[</span><span class="va">MDV</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span></code></pre></div>
<p>Next, we’ll add the prediction variable from the first replicate of
simulated data into our observed data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">PRED</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">[</span><span class="va">REP</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">PRED</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="observed">
<code>observed()</code><a class="anchor" aria-label="anchor" href="#observed"></a>
</h2>
<p>The <code><a href="../reference/observed.html">observed()</a></code> function is always the first function
used in the VPC piping chain and is used to specify the observed dataset
and corresponding variables. There are three arguments that are required
to use <code>observed</code>. The first argument is either a
<code>data.frame</code> or <code>data.table</code>, the second argument
is the name of x-variable in the observed data, and the third argument
is the name of the y-variable. Note that variable names should be
unquoted.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/certara/tidyvpc" class="external-link">tidyvpc</a></span><span class="op">)</span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulated">
<code>simulated()</code><a class="anchor" aria-label="anchor" href="#simulated"></a>
</h2>
<p>The <code><a href="../reference/simulated.html">simulated()</a></code> function is used to specify the
simulated dataset and corresponding variables. There are two arguments
that are required in order to use <code><a href="../reference/simulated.html">simulated()</a></code>. Since the
function is “piped” in after the <code><a href="../reference/observed.html">observed()</a></code> function, the
first argument is the tidyvpcobj and should not be included, followed by
the name of the simulated data, then the name of y-variable in the
simulated data. Variable names should be unquoted and x-variable should
not be included as it is recycled from the <code><a href="../reference/observed.html">observed()</a></code>
function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="binning">
<code>binning()</code><a class="anchor" aria-label="anchor" href="#binning"></a>
</h2>
<p>The <code><a href="../reference/binning.html">binning()</a></code> function provides the binning method to
derive the VPC and should be inputted as a character string in the
<code>bin</code> argument. Binning methods include: “ntile”, “pam”,
“sd”, “equal”, “pretty”, “quantile”, “kmeans”, “jenks”, “centers”,
“breaks”. Some methods such as “ntile” and “pam” will require you to
specify the number of bins using the <code>nbins</code> argument (e.g.,
<code>nbins = 9</code>).</p>
<p>If using <code>bin = "centers"</code> or <code>bin = "breaks</code>,
you must also provide the centers/breaks argument as a numeric vector in
the function (e.g., <code>centers = c(1,3,5,7)</code>).</p>
<p>You can also bin directly on x-variable. If using this type of
binning, the bin argument should be the unquoted variable name that you
used in the <code><a href="../reference/observed.html">observed()</a></code> function (e.g.,
<code>bin = NTIME</code> for the Nominal Time variable in the data).</p>
<p>Binning on x-variable, NTIME</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span></span></code></pre></div>
<p>Binning with “ntile”</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"ntile"</span>, nbins <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></code></pre></div>
<p>Binning with “breaks”</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"breaks"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="binless">
<code>binless()</code><a class="anchor" aria-label="anchor" href="#binless"></a>
</h2>
<p><em>Note: The <code><a href="../reference/binless.html">binless()</a></code> examples below relate to a
continuous VPC. See <a href="https://certara.github.io/tidyvpc/articles/tidyvpc_cat.html" class="external-link">examples</a>
of <code><a href="../reference/binless.html">binless()</a></code> implementation for categorical VPC.</em></p>
<p>Binless methods for continuous VPC use Additive Quantile Regression
(AQR) in place of traditional binning. By default,
<code><a href="../reference/binless.html">binless()</a></code> performs AQR at the 5%, 50%, and 95% quantiles,
but you can change this using the <code>qpred</code> argument in
<code><a href="../reference/vpcstats.html">vpcstats()</a></code>, which takes a numeric vector of length 3 (e.g.,
<code>qpred =  c(.1, .5, .9)</code> for the 10%, 50%, 90%
quantiles).</p>
<p>The lambda smoothing parameters for each quantile are optimized by
default with AIC as indicated by the <code>optimize = TRUE</code>
argument. If you would like to use different lambda values for each
quantile set <code>optimize = FALSE</code> and specify lambda values for
each quantile as a numeric vector of length 3 with the
<code>lambda</code> argument (e.g., <code>lambda = c(1,3,2)</code>
corresponds to the lambda values for the quantiles in the
<code>qpred</code> argument (lower, median, upper)). Note: The higher
the lambda value the smoother the fit to the data.</p>
<p>Binless optimized</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binless.html">binless</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Binless with user-specified lambda values at 10%, 50%, 90% quantiles.
Set <code>optimize = FALSE</code> and provide lambda smoothing
parameters as a vector of length 3 for lower, median, upper
quantiles.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binless.html">binless</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>, optimize <span class="op">=</span> <span class="cn">FALSE</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="vpcstats">
<code>vpcstats()</code><a class="anchor" aria-label="anchor" href="#vpcstats"></a>
</h2>
<p>The <code><a href="../reference/vpcstats.html">vpcstats()</a></code> function is always the final function
used in the piping chain and calculates the statistics needed to plot a
VPC. If using <code><a href="../reference/binning.html">binning()</a></code>methods, you may specify alternative
quantiles using the <code>qpred</code> argument. The default quantiles
used are 5%, 50%, 95% (e.g.,
<code>qpred = c(0.05, 0.5, 0.95)</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-15-1.png" width="640"></p>
</div>
<div class="section level2">
<h2 id="stratify">
<code>stratify()</code><a class="anchor" aria-label="anchor" href="#stratify"></a>
</h2>
<p>To stratify VPC, include the <code><a href="../reference/stratify.html">stratify()</a></code> function before
using the <code><a href="../reference/binning.html">binning()</a></code> or <code><a href="../reference/binless.html">binless()</a></code> function and
use the unquoted stratification variable(s) name as a formula. Let’s
stratify on <code>GENDER</code> in the data, which contains 2 levels
(GENDER = “M”, GENDER = “F”). Include as many stratification variables
as your model calls for.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">GENDER</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"pam"</span>, nbins <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-16-1.png" width="640"></p>
<p>Using multiple stratification variables <code>GENDER</code> and
<code>STUDY</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">GENDER</span> <span class="op">+</span> <span class="va">STUDY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binless.html">binless</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-17-1.png" width="640"></p>
</div>
<div class="section level2">
<h2 id="censoring">
<code>censoring()</code><a class="anchor" aria-label="anchor" href="#censoring"></a>
</h2>
<p><em>Note: The <code><a href="../reference/censoring.html">censoring()</a></code> function is only applicable
for continuous VPC.</em></p>
<p>To censor observed data below lower limit of quantification (LLOQ),
include the <code><a href="../reference/censoring.html">censoring()</a></code> function after
<code><a href="../reference/simulated.html">simulated()</a></code> and use the <code>lloq</code> argument to
specify either a variable in the data or specific value for censoring.
The <code>blq</code> argument creates a logical TRUE/FALSE in the data
that indicates whether the value is below the limit of quantification
and is typically defined as rows with DV &lt; LLOQ in the data. Using
the <code><a href="../reference/censoring.html">censoring()</a></code> function will censor only observed data
below lower limit of quantification when plotting, simulated data will
still be plotted.</p>
<p>Censoring using numeric value.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>blq<span class="op">=</span><span class="op">(</span><span class="va">DV</span> <span class="op">&lt;</span> <span class="fl">25</span><span class="op">)</span>, lloq<span class="op">=</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"jenks"</span>, nbins <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span>, censoring.type <span class="op">=</span> <span class="st">"blq"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-18-1.png" width="640"></p>
<p>The <code>tidyvpc</code> package also allows you to use LLOQ values
within your data and different LLOQ for each level of stratification
variable. We’ll set an <code>LLOQ</code> value of <code>50</code> for
<code>Study A</code> and <code>25</code> for <code>Study B</code> and
calculate statistics at 10%, 50%, 90% quantiles.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">LLOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">50</span>, <span class="fl">25</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>blq<span class="op">=</span><span class="op">(</span><span class="va">DV</span> <span class="op">&lt;</span> <span class="va">LLOQ</span><span class="op">)</span>, lloq<span class="op">=</span><span class="va">LLOQ</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">STUDY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"pam"</span>, nbins <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span>, censoring.type <span class="op">=</span> <span class="st">"blq"</span>, facet.scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-19-1.png" width="640"></p>
<p>The <code>tidyvpc</code> package also supports usage of
<code><a href="../reference/censoring.html">censoring()</a></code> with ALQ data, similar to above usage with BLQ
data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">ULOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">125</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>alq <span class="op">=</span> <span class="va">DV</span> <span class="op">&gt;</span> <span class="va">ULOQ</span>, uloq <span class="op">=</span> <span class="va">ULOQ</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">STUDY</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To plot the above <code>vpc</code> and include the percentage of ALQ
plot, you’d run <code>plot(vpc, censoring.type = "alq")</code>.</p>
<p>If using <code><a href="../reference/censoring.html">censoring()</a></code> with both ALQ and BLQ data, set
<code>censoring.type = "both"</code> in the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function
to display both percentage of BLQ and ALQ plots as a grid in the
resulting VPC plot.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">LLOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">50</span>, <span class="fl">25</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">obs_data</span><span class="op">$</span><span class="va">ULOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">125</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>blq <span class="op">=</span> <span class="va">DV</span> <span class="op">&lt;</span> <span class="va">LLOQ</span>, lloq <span class="op">=</span> <span class="va">LLOQ</span>,  alq <span class="op">=</span> <span class="va">DV</span> <span class="op">&gt;</span> <span class="va">ULOQ</span>, uloq <span class="op">=</span> <span class="va">ULOQ</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">STUDY</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span>, censoring.type <span class="op">=</span> <span class="st">"both"</span>, facet.scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-21-1.png" width="640"></p>
<p>If you want to return the percentage of BLQ and/or ALQ plots
individually as elements in a list, instead of arranged in a grid, use
the <code>censoring.output</code> argument e.g.,
<code>plot_list &lt;- plot(vpc, censoring.type = "both", censoring.output = "list")</code>.</p>
</div>
<div class="section level2">
<h2 id="predcorrect">
<code>predcorrect()</code><a class="anchor" aria-label="anchor" href="#predcorrect"></a>
</h2>
<p><em>Note: The <code><a href="../reference/predcorrect.html">predcorrect()</a></code> function is only applicable
for continuous VPC.</em></p>
<p>To derive a prediction corrected VPC (pcVPC), use the
<code><a href="../reference/predcorrect.html">predcorrect()</a></code> function. The <code><a href="../reference/predcorrect.html">predcorrect()</a></code>
function requires the argument, <code>pred</code>, which should be the
unquoted variable name of the population prediction variable in the
data. The <code><a href="../reference/predcorrect.html">predcorrect()</a></code> function may be called either
before or after specifying
<code><a href="../reference/binning.html">binning()</a></code>/<code><a href="../reference/binless.html">binless()</a></code>. If using the
<code><a href="../reference/binless.html">binless()</a></code> function with <code><a href="../reference/predcorrect.html">predcorrect()</a></code>, LOESS
pcVPC will be performed.</p>
<p><em>Note: If the model was fit using log scale of DV, make sure to
include the argument <code>log = TRUE</code> in
<code><a href="../reference/predcorrect.html">predcorrect()</a></code> to perform the appropriate prediction
correction calculation.</em></p>
<p>Prediction corrected using binning methods.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span><span class="va">GENDER</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/predcorrect.html">predcorrect</a></span><span class="op">(</span>pred<span class="op">=</span><span class="va">PRED</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-22-1.png" width="640"></p>
<p>LOESS prediction corrected using binless method for 10%, 50%, 90%
quantiles. If <code>optimize = TRUE</code>, the LOESS smoothing
parameter, span, will be automatically optimized using AIC.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span><span class="va">GENDER</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binless.html">binless</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>, optimize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/predcorrect.html">predcorrect</a></span><span class="op">(</span>pred<span class="op">=</span><span class="va">PRED</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-23-1.png" width="640"></p>
<p>To specify your own smoothing value for LOESS pcVPC instead of
optimizing with AIC, use the <code>span</code> argument in the
<code><a href="../reference/binless.html">binless()</a></code> function. The <code>span</code> argument is a
numeric value between [0,1], with higher values providing a smoother
fit. Remember, to also include the smoothing parameters for AQR by using
the <code>lambda</code> argument and set
<code>optimize = FALSE</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/predcorrect.html">predcorrect</a></span><span class="op">(</span>pred<span class="op">=</span><span class="va">PRED</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binless.html">binless</a></span><span class="op">(</span>optimize <span class="op">=</span> <span class="cn">FALSE</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.95</span>,<span class="fl">3</span>,<span class="fl">1.2</span><span class="op">)</span>, span <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-24-1.png" width="640"></p>
</div>
<div class="section level2">
<h2 id="extending-further">Extending further<a class="anchor" aria-label="anchor" href="#extending-further"></a>
</h2>
<p>Below are some examples of advanced use cases of the
<code>tidyvpc</code> package.</p>
<div class="section level3">
<h3 id="different-binning-methods-by-strata">Different binning methods by strata<a class="anchor" aria-label="anchor" href="#different-binning-methods-by-strata"></a>
</h3>
<p>To use different binning methods for different stratification
variables, and/or for each level of stratification variable, use
multiple calls to the <code><a href="../reference/binning.html">binning()</a></code> function in combination
with the <code>stratum</code> argument. Make sure to set
<code>by.strata = T</code></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">GENDER</span> <span class="op">+</span> <span class="va">STUDY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GENDER <span class="op">=</span> <span class="st">"M"</span>, STUDY <span class="op">=</span> <span class="st">"Study A"</span><span class="op">)</span>, bin <span class="op">=</span> <span class="st">"jenks"</span>, nbins <span class="op">=</span> <span class="fl">5</span>, by.strata <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GENDER <span class="op">=</span> <span class="st">"F"</span>, STUDY <span class="op">=</span> <span class="st">"Study A"</span><span class="op">)</span>, bin <span class="op">=</span> <span class="st">"centers"</span>, centers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span><span class="op">)</span>, by.strata <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GENDER <span class="op">=</span> <span class="st">"M"</span>, STUDY <span class="op">=</span> <span class="st">"Study B"</span><span class="op">)</span>, bin <span class="op">=</span> <span class="st">"kmeans"</span>, by.strata <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GENDER <span class="op">=</span> <span class="st">"F"</span>, STUDY <span class="op">=</span> <span class="st">"Study B"</span><span class="op">)</span>, bin <span class="op">=</span> <span class="st">"pam"</span>, nbins <span class="op">=</span> <span class="fl">5</span>, by.strata <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/predcorrect.html">predcorrect</a></span><span class="op">(</span>pred<span class="op">=</span><span class="va">PRED</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-25-1.png" width="640"></p>
</div>
<div class="section level3">
<h3 id="different-smoothing-values-for-each-level-of-stratification-variable">Different smoothing values for each level of stratification
variable<a class="anchor" aria-label="anchor" href="#different-smoothing-values-for-each-level-of-stratification-variable"></a>
</h3>
<p>To use different smoothing parameters for each level of
stratification variable if using the <code><a href="../reference/binless.html">binless()</a></code> function,
use a single call of the <code><a href="../reference/binless.html">binless()</a></code> function and include a
<code>data.frame</code> with the column names of stratification variable
and corresponding level. To use different <code>span</code> values for
each level of stratification variable, use a vector the length of n
levels of strata. Note: If using more than one stratification variable
with the <code><a href="../reference/binless.html">binless()</a></code> function, you must set
<code>optimize = TRUE</code> and optimize lambda and span using AIC.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">user_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>GENDER_F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>, GENDER_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.9</span>,<span class="fl">3</span>,<span class="fl">2.25</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span> <span class="va">GENDER</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binless.html">binless</a></span><span class="op">(</span>optimize <span class="op">=</span> <span class="cn">FALSE</span>, lambda <span class="op">=</span> <span class="va">user_lambda</span>, span <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.85</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/predcorrect.html">predcorrect</a></span><span class="op">(</span>pred<span class="op">=</span><span class="va">PRED</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-26-1.png" width="640"></p>
</div>
<div class="section level3">
<h3 id="visualize-bins">Visualize bins<a class="anchor" aria-label="anchor" href="#visualize-bins"></a>
</h3>
<p>If using <code><a href="../reference/binning.html">binning()</a></code> methods, you can visualize bins by
using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function on the <code>tidyvpcobj</code>
without calling <code><a href="../reference/vpcstats.html">vpcstats()</a></code>. Once you are satisfied with the
binning method, simply call <code><a href="../reference/vpcstats.html">vpcstats()</a></code> on the existing
<code>tidyvpcobj</code> to compute VPC percentiles and prediction
intervals (e.g., <code>vpc %&gt;% vpcstats()</code>).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"jenks"</span>, nbins <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-27-1.png" width="640"></p>
</div>
<div class="section level3">
<h3 id="obtain-bin-information">Obtain bin information<a class="anchor" aria-label="anchor" href="#obtain-bin-information"></a>
</h3>
<p>To obtain information about the bins, including the number of
observations, xmedian, xmean, xmin, xmax, xmidpoint, xleft, xright, and
xcenter, use the <code><a href="../reference/bininfo.html">bininfo()</a></code> function from
<code>tidyvpc</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"jenks"</span>, nbins <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bin_information</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bin_information</span><span class="op">)</span></span>
<span><span class="co">#&gt;             bin nobs    xmedian      xmean      xmin      xmax      xmid</span></span>
<span><span class="co">#&gt; 1: [0.158,1.89)  213  0.8418133  0.8717959 0.1575342  1.860852  1.009193</span></span>
<span><span class="co">#&gt; 2:  [1.89,4.83)  187  2.8021930  2.9458444 1.8851078  4.772347  3.328727</span></span>
<span><span class="co">#&gt; 3:  [4.83,9.45)   96  6.6279698  6.9869973 4.8283449  9.259398  7.043872</span></span>
<span><span class="co">#&gt; 4:  [9.45,15.8]   54 11.9639045 12.0388598 9.4470340 15.848161 12.647597</span></span>
<span><span class="co">#&gt;        xleft    xright   xcenter</span></span>
<span><span class="co">#&gt; 1: 0.1575342  1.872980  1.015257</span></span>
<span><span class="co">#&gt; 2: 1.8729798  4.800346  3.336663</span></span>
<span><span class="co">#&gt; 3: 4.8003458  9.353216  7.076781</span></span>
<span><span class="co">#&gt; 4: 9.3532162 15.848161 12.600688</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-ggplot2-with-tidyvpc">Using <code>ggplot2</code> with <code>tidyvpc</code><a class="anchor" aria-label="anchor" href="#using-ggplot2-with-tidyvpc"></a>
</h3>
<p>While the built-in <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function make it easy to
quickly visualize the derived VPC, the <code>tidyvpcobj</code> can be
plotted using <code>ggplot2</code> for complete plot customization.</p>
<div class="section level4">
<h4 id="plot-vpc-with-ggplot2">Plot VPC with <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#plot-vpc-with-ggplot2"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">obs_data</span><span class="op">$</span><span class="va">LLOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">50</span>, <span class="fl">25</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>blq <span class="op">=</span> <span class="va">DV</span> <span class="op">&lt;</span> <span class="va">LLOQ</span>, lloq <span class="op">=</span> <span class="va">LLOQ</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span><span class="va">STUDY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">stats</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xbin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">STUDY</span>, scales <span class="op">=</span> <span class="st">"free"</span>, as.table <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lo</span>, ymax <span class="op">=</span> <span class="va">hi</span>, fill <span class="op">=</span> <span class="va">qname</span>, col <span class="op">=</span> <span class="va">qname</span>, group <span class="op">=</span> <span class="va">qname</span><span class="op">)</span>,alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">md</span>, col <span class="op">=</span> <span class="va">qname</span>, group <span class="op">=</span> <span class="va">qname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, linetype <span class="op">=</span> <span class="va">qname</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">STUDY</span>, <span class="va">LLOQ</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">LLOQ</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dotted"</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">LLOQ</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"STUDY"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="va">LLOQ</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"LLOQ"</span>, <span class="va">LLOQ</span>, sep <span class="op">=</span> <span class="st">"="</span><span class="op">)</span>, <span class="op">)</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Simulated Percentiles\nMedian (lines) 95% CI (areas)"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.1"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.9"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10%"</span>, <span class="st">"50%"</span>, <span class="st">"90%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Simulated Percentiles\nMedian (lines) 95% CI (areas)"</span>, </span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.1"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.9"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10%"</span>, <span class="st">"50%"</span>, <span class="st">"90%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Observed Percentiles\nMedian (lines) 95% CI (areas)"</span>, </span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.1"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.9"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span><span class="op">)</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10%"</span>, <span class="st">"50%"</span>, <span class="st">"90%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.key.width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"TIME"</span>, y <span class="op">=</span> <span class="st">"Concentration"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vpc</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xleft</span>, <span class="va">xright</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">strat</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray80"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xleft</span>, <span class="va">xright</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">strat</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, sides <span class="op">=</span> <span class="st">"t"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-29-1.png" width="640"></p>
</div>
<div class="section level4">
<h4 id="plot-rectangles-using-bininfo">Plot rectangles using <code>bininfo()</code><a class="anchor" aria-label="anchor" href="#plot-rectangles-using-bininfo"></a>
</h4>
<p>The results from <code><a href="../reference/bininfo.html">bininfo()</a></code> make it easy to plot a
rectangle VPC using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x<span class="op">=</span><span class="va">TIME</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y<span class="op">=</span><span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="st">"jenks"</span>, nbins <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Get vpcstats df</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">vpc</span><span class="op">$</span><span class="va">stats</span></span>
<span><span class="co">#Get bininfo df</span></span>
<span><span class="va">bin_information</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span></span>
<span><span class="co">#Left join bin_info to vpcstats on bin</span></span>
<span><span class="va">bin_information</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">[</span><span class="va">bin_information</span>, on <span class="op">=</span> <span class="st">"bin"</span><span class="op">]</span></span>
<span><span class="co">#Generate ymin</span></span>
<span><span class="va">bin_information</span> <span class="op">&lt;-</span> <span class="va">bin_information</span><span class="op">[</span>, <span class="va">ymin</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"bin"</span><span class="op">]</span></span>
<span><span class="co">#Generate ymax</span></span>
<span><span class="va">bin_information</span> <span class="op">&lt;-</span> <span class="va">bin_information</span><span class="op">[</span>, <span class="va">ymax</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"bin"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bin_information</span><span class="op">)</span></span>
<span><span class="co">#&gt;             bin      xbin qname      y        lo       md        hi nobs</span></span>
<span><span class="co">#&gt; 1: [0.158,1.89) 0.8418133 q0.05  22.94  19.58905  22.7307  27.73307  213</span></span>
<span><span class="co">#&gt; 2: [0.158,1.89) 0.8418133  q0.5  61.50  57.45770  61.7670  67.05757  213</span></span>
<span><span class="co">#&gt; 3: [0.158,1.89) 0.8418133 q0.95 144.40 121.90995 132.7460 149.47290  213</span></span>
<span><span class="co">#&gt; 4:  [1.89,4.83) 2.8021930 q0.05  29.38  21.34827  28.0135  32.11742  187</span></span>
<span><span class="co">#&gt; 5:  [1.89,4.83) 2.8021930  q0.5  74.10  70.76337  76.1745  82.59877  187</span></span>
<span><span class="co">#&gt; 6:  [1.89,4.83) 2.8021930 q0.95 179.00 141.91740 157.6140 181.46822  187</span></span>
<span><span class="co">#&gt;      xmedian     xmean      xmin     xmax     xmid     xleft   xright  xcenter</span></span>
<span><span class="co">#&gt; 1: 0.8418133 0.8717959 0.1575342 1.860852 1.009193 0.1575342 1.872980 1.015257</span></span>
<span><span class="co">#&gt; 2: 0.8418133 0.8717959 0.1575342 1.860852 1.009193 0.1575342 1.872980 1.015257</span></span>
<span><span class="co">#&gt; 3: 0.8418133 0.8717959 0.1575342 1.860852 1.009193 0.1575342 1.872980 1.015257</span></span>
<span><span class="co">#&gt; 4: 2.8021930 2.9458444 1.8851078 4.772347 3.328727 1.8729798 4.800346 3.336663</span></span>
<span><span class="co">#&gt; 5: 2.8021930 2.9458444 1.8851078 4.772347 3.328727 1.8729798 4.800346 3.336663</span></span>
<span><span class="co">#&gt; 6: 2.8021930 2.9458444 1.8851078 4.772347 3.328727 1.8729798 4.800346 3.336663</span></span>
<span><span class="co">#&gt;     ymin  ymax</span></span>
<span><span class="co">#&gt; 1: 22.94 144.4</span></span>
<span><span class="co">#&gt; 2: 22.94 144.4</span></span>
<span><span class="co">#&gt; 3: 22.94 144.4</span></span>
<span><span class="co">#&gt; 4: 29.38 179.0</span></span>
<span><span class="co">#&gt; 5: 29.38 179.0</span></span>
<span><span class="co">#&gt; 6: 29.38 179.0</span></span></code></pre></div>
<p>Plot rectangles using <code>ymin</code> and <code>ymax</code>, the
min/max y values in <code>vpc$stats</code> grouped by bin.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bin_information</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xbin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">md</span>, col <span class="op">=</span> <span class="va">qname</span>, group <span class="op">=</span> <span class="va">qname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, linetype <span class="op">=</span> <span class="va">qname</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span> <span class="va">xleft</span>,xmax<span class="op">=</span> <span class="va">xright</span>, ymin <span class="op">=</span>  <span class="va">ymin</span>, ymax <span class="op">=</span>  <span class="va">ymax</span><span class="op">)</span>,alpha <span class="op">=</span> <span class="fl">.1</span>, col <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vpc</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Simulated Percentiles\nMedian (lines) 95% CI (areas)"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.05"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.95"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5%"</span>, <span class="st">"50%"</span>, <span class="st">"95%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Observed Percentiles\nMedian (lines) 95% CI (areas)"</span>, </span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.05"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.95"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span><span class="op">)</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5%"</span>, <span class="st">"50%"</span>, <span class="st">"95%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bin_information</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xleft</span>, <span class="va">xright</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bin_information</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xleft</span>, <span class="va">xright</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, sides <span class="op">=</span> <span class="st">"t"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.key.width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"TIME"</span>, y <span class="op">=</span> <span class="st">"Concentration"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-31-1.png" width="640"></p>
<p>Alternatively, we can obtain the required data for plotting used in
the above <code>bin_information</code> data frame by merging
<code>vpc$stats</code> and <code>bininfo(vpc)</code> on <code>bin</code>
in the <code>ggplot2</code> data argument. If stratifying, you will need
to include the name of the stratification variable(s) in the
<code>data.table</code> merge (e.g.,
<code>vpc$stats[bininfo(vpc), on=c("STUDY", "bin")]</code>). In the
rectangle VPC below, we will stratify on <code>STUDY</code> and plot
rectangles for each quantile.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">LLOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">50</span>, <span class="fl">25</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>blq <span class="op">=</span> <span class="va">DV</span> <span class="op">&lt;</span> <span class="va">LLOQ</span>, lloq <span class="op">=</span> <span class="va">LLOQ</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span><span class="va">STUDY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span><span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span>, on<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDY"</span>, <span class="st">"bin"</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xbin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">STUDY</span>, scales <span class="op">=</span> <span class="st">"free"</span>, as.table <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">xleft</span>, xmax <span class="op">=</span> <span class="va">xright</span>, ymin <span class="op">=</span> <span class="va">lo</span>, ymax <span class="op">=</span> <span class="va">hi</span>, fill <span class="op">=</span> <span class="va">qname</span>, col <span class="op">=</span> <span class="va">qname</span>, group <span class="op">=</span> <span class="va">qname</span><span class="op">)</span>,alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xleft</span>, xend <span class="op">=</span> <span class="va">xright</span>, y <span class="op">=</span> <span class="va">md</span>, yend <span class="op">=</span> <span class="va">md</span>, col <span class="op">=</span> <span class="va">qname</span>, group <span class="op">=</span> <span class="va">qname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xleft</span>, xend <span class="op">=</span> <span class="va">xright</span>, y <span class="op">=</span> <span class="va">y</span>, yend <span class="op">=</span> <span class="va">y</span>, linetype <span class="op">=</span> <span class="va">qname</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">md</span>, col <span class="op">=</span> <span class="va">qname</span>, group <span class="op">=</span> <span class="va">qname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, linetype <span class="op">=</span> <span class="va">qname</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">obs_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">STUDY</span>, <span class="va">LLOQ</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">LLOQ</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dotted"</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">LLOQ</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"STUDY"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="va">LLOQ</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"LLOQ"</span>, <span class="va">LLOQ</span>, sep <span class="op">=</span> <span class="st">"="</span><span class="op">)</span>, <span class="op">)</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Simulated Percentiles\nMedian (lines) 95% CI (areas)"</span>,</span>
<span>                      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.1"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.9"</span><span class="op">)</span>, </span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10%"</span>, <span class="st">"50%"</span>, <span class="st">"90%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Simulated Percentiles\nMedian (lines) 95% CI (areas)"</span>, </span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.1"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.9"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10%"</span>, <span class="st">"50%"</span>, <span class="st">"90%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Observed Percentiles\nMedian (lines) 95% CI (areas)"</span>, </span>
<span>                        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q0.1"</span>, <span class="st">"q0.5"</span>, <span class="st">"q0.9"</span><span class="op">)</span>, </span>
<span>                        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span><span class="op">)</span>, </span>
<span>                        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10%"</span>, <span class="st">"50%"</span>, <span class="st">"90%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.key.width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"TIME"</span>, y <span class="op">=</span> <span class="st">"Concentration"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vpc</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xleft</span>, <span class="va">xright</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">strat</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray80"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/bininfo.html">bininfo</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xleft</span>, <span class="va">xright</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">strat</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, sides <span class="op">=</span> <span class="st">"t"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 18 rows containing missing values (`geom_segment()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-32-1.png" width="640"></p>
</div>
<div class="section level4">
<h4 id="plot-below-quantification-limit-bql">Plot Below Quantification Limit (BQL)<a class="anchor" aria-label="anchor" href="#plot-below-quantification-limit-bql"></a>
</h4>
<p>If using the <code><a href="../reference/censoring.html">censoring()</a></code> function, the resulting
<code>tidyvpcobj</code> will also contain a pctblq table. Use
<code>ggplot2</code> to plot the percentage of data below the limit of
quantification across bins.</p>
<p>We can include <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> using the <code>lo</code>
and <code>hi</code> columns in the <code>vpc$pctblq</code> table to
denote the lower/upper bounds of our confidence interval. Let’s also
plot the median %blq of the simulated data using the <code>md</code>
column in the <code>vpc$pctblq</code> table.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_data</span><span class="op">$</span><span class="va">LLOQ</span> <span class="op">&lt;-</span> <span class="va">obs_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">STUDY</span> <span class="op">==</span> <span class="st">"Study A"</span>, <span class="fl">50</span>, <span class="fl">25</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">vpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observed.html">observed</a></span><span class="op">(</span><span class="va">obs_data</span>, x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/simulated.html">simulated</a></span><span class="op">(</span><span class="va">sim_data</span>, y <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/censoring.html">censoring</a></span><span class="op">(</span>blq <span class="op">=</span> <span class="va">DV</span> <span class="op">&lt;</span> <span class="va">LLOQ</span>, lloq <span class="op">=</span> <span class="va">LLOQ</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="op">~</span><span class="va">STUDY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>bin <span class="op">=</span> <span class="va">NTIME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/vpcstats.html">vpcstats</a></span><span class="op">(</span>qpred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vpc</span><span class="op">$</span><span class="va">pctblq</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">STUDY</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xbin</span>, ymin<span class="op">=</span> <span class="va">lo</span>, ymax <span class="op">=</span> <span class="va">hi</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xbin</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xbin</span>, y <span class="op">=</span> <span class="va">md</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"TIME"</span>, y<span class="op">=</span> <span class="st">"% BLQ"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyvpc_cont_files/figure-html/unnamed-chunk-33-1.png" width="640"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Olivier Barriere, Benjamin Rich, James Craig, Samer Mouksassi, Certara USA, Inc..</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
